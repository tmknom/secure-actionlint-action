name: Secure actionlint
description: |
  This action securely runs actionlint in a Docker container to lint GitHub Actions workflow files.
  It reduces security risks from compromised or malicious third-party tools.
  To achieve this, it enforces strict container isolation, disables network connections, and drops unnecessary privileges.

  ## Usage

  ```yaml
    steps:
      - name: Secure actionlint
        uses: tmknom/secure-actionlint-action@v0
  ```

runs:
  using: composite

  steps:
    - name: Install
      id: install
      run: |
        echo "::group::Install"
        set -x
        image="$(head -1 "${GITHUB_ACTION_PATH}/Dockerfile" | cut -d' ' -f2)"
        echo "image=${image}" >> "${GITHUB_OUTPUT}"
        docker pull "${image}"
      shell: bash

    - name: Show version
      env:
        IMAGE: ${{ steps.install.outputs.image }}
      run: |
        echo "::group::Show version"
        set -x
        docker run --interactive --rm --read-only --user guest \
          --security-opt no-new-privileges --cap-drop all --network none \
          "${IMAGE}" --version
        echo "::endgroup::"
      shell: bash

    - name: Run
      env:
        IMAGE: ${{ steps.install.outputs.image }}
      run: |
        echo "::group::Run"
        set -x
        docker run --interactive --rm --read-only --user guest \
          --security-opt no-new-privileges --cap-drop all --network none \
          --volume "${PWD}:${PWD}" --workdir "${PWD}" \
          "${IMAGE}" --color
        echo "::endgroup::"
      shell: bash
